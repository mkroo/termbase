<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/default :: head('Space 선택')}"></head>
<body class="bg-white dark:bg-notion-bg-dark min-h-screen">
<nav th:replace="~{layout/default :: nav}"></nav>

<main class="max-w-5xl mx-auto px-6 py-8">
    <div class="mb-6">
        <a th:href="@{/confluence/settings}" class="text-notion-text-secondary dark:text-notion-text-secondary-dark hover:text-notion-accent text-sm mb-2 inline-block">
            &larr; 설정으로 돌아가기
        </a>
        <h1 class="text-2xl font-bold text-notion-text dark:text-notion-text-dark" th:text="${workspace.siteName}">Site Name</h1>
        <p class="text-notion-text-secondary dark:text-notion-text-secondary-dark mt-1">
            수집할 Space를 선택하세요.
        </p>
    </div>

    <!-- Flash Messages -->
    <div th:if="${success}" class="mb-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
        <p class="text-sm text-green-800 dark:text-green-200" th:text="${success}"></p>
    </div>
    <div th:if="${error}" class="mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
        <p class="text-sm text-red-800 dark:text-red-200" th:text="${error}"></p>
    </div>

    <form th:action="@{/confluence/spaces/{cloudId}/select(cloudId=${workspace.cloudId})}" method="post">
        <div th:if="${#lists.isEmpty(workspace.spaces)}" class="text-center py-12">
            <p class="text-notion-text-secondary dark:text-notion-text-secondary-dark">Space가 없습니다.</p>
        </div>

        <div th:unless="${#lists.isEmpty(workspace.spaces)}" class="space-y-2">
            <div th:each="space : ${workspace.spaces}"
                 class="flex items-center gap-3 p-3 bg-notion-bg-secondary dark:bg-notion-bg-secondary-dark rounded-lg hover:bg-notion-bg-hover dark:hover:bg-notion-bg-hover-dark transition cursor-pointer"
                 th:onclick="|toggleCheckbox('space-${space.spaceKey}')|">
                <input type="checkbox"
                       th:id="'space-' + ${space.spaceKey}"
                       name="spaceKeys"
                       th:value="${space.spaceKey}"
                       th:checked="${space.isSelected}"
                       class="w-4 h-4 text-notion-accent rounded border-notion-border dark:border-notion-border-dark focus:ring-notion-accent cursor-pointer"
                       onclick="event.stopPropagation()">
                <label th:for="'space-' + ${space.spaceKey}" class="flex-1 cursor-pointer" onclick="event.stopPropagation()">
                    <span class="font-medium text-notion-text dark:text-notion-text-dark" th:text="${space.name}">Space Name</span>
                    <span class="text-sm text-notion-text-secondary dark:text-notion-text-secondary-dark ml-2" th:text="'(' + ${space.spaceKey} + ')'">KEY</span>
                </label>
            </div>
        </div>

        <div class="mt-6 flex gap-3">
            <button type="submit"
                    class="px-4 py-2 bg-notion-accent text-white text-sm font-medium rounded-lg hover:bg-notion-accent-hover transition">
                선택 저장
            </button>
            <button type="button" onclick="selectAll()"
                    class="px-4 py-2 bg-notion-bg-hover dark:bg-notion-bg-hover-dark text-notion-text dark:text-notion-text-dark text-sm rounded-lg hover:bg-notion-border dark:hover:bg-notion-border-dark transition">
                전체 선택
            </button>
            <button type="button" onclick="deselectAll()"
                    class="px-4 py-2 bg-notion-bg-hover dark:bg-notion-bg-hover-dark text-notion-text dark:text-notion-text-dark text-sm rounded-lg hover:bg-notion-border dark:hover:bg-notion-border-dark transition">
                전체 해제
            </button>
        </div>
    </form>
</main>

<script>
    function toggleCheckbox(id) {
        const checkbox = document.getElementById(id);
        checkbox.checked = !checkbox.checked;
    }

    function selectAll() {
        document.querySelectorAll('input[name="spaceKeys"]').forEach(cb => cb.checked = true);
    }

    function deselectAll() {
        document.querySelectorAll('input[name="spaceKeys"]').forEach(cb => cb.checked = false);
    }
</script>
</body>
</html>
